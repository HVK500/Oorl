"use strict";function constructUrl(){var e=originalUrl;if(0!=numOfOriginalParams)for(var t=numOfOriginalParams,n=0;n!=t;n++){var a=document.getElementById("cb"+n);if(a.checked){var i=document.getElementById("lbl"+n).innerText;i=i.replace(":","");var l=document.getElementById("in"+n).value;e+=(-1==e.indexOf("?")?"?":"&")+i+"="+encodeParamUrl(l)}}if(0!=numOfCustomeParams)for(var t=numOfCustomeParams+1,n=1;n!=t;n++){var a=document.getElementById("ccb"+n);if(a.checked){var i=document.getElementById("cinOne"+n).value,l=document.getElementById("cinTwo"+n).value;""==i&&""==l||(e+=(-1==e.indexOf("?")?"?":"&")+i+"="+encodeParamUrl(l))}}return e}function createParamTable(e){if(-1!=e.search("&")){var t=e.split("&");t.splice(0,1),numOfOriginalParams=t.length,injectHtml("tableContainer",null,'<table id="paramTable"></table>');for(var n=document.getElementById("paramTable"),a=0;a<t.length;a++){var i=t[a].split("="),l=n.insertRow(-1),r=l.insertCell(0);r.style="width: 22px";var o=l.insertCell(1);o.style="width: 104px;";var c=l.insertCell(2);c.style="width: 636px";var u=i[0],m="in"+a;injectHtml(null,r,'<input id="cb'+a+'" type="checkbox" checked>'),injectHtml(null,o,'<label id="lbl'+a+'">'+u+":   </label>"),i.length>1?injectHtml(null,c,'<input id="'+m+'" type="text" value="'+decodeParamIsUrl(i[1])+'" placeholder="Parameter value">'):injectHtml(null,c,'<input id="'+m+'" type="text" placeholder="Parameter value">'),checkBoxEvent("cb"+a,"in"+a,null),client.LogCount("extension.parameters.existing."+i[0],1)}}else injectHtml("tableContainer",null,'<h5 id="np">No parameters... This is awkward.</h5>'),client.LogCount("extension.loaded.noParameters",1)}function checkBoxEvent(e,t,n){var a=document.getElementById(e),i=document.getElementById(t),l=document.getElementById(n||null),r=function(){a.checked?i.disabled=!1:i.disabled=!0},o=function(){a.checked?(i.disabled=!1,l.disabled=!1):(i.disabled=!0,l.disabled=!0)};a.onclick=null==l?r:o}function encodeParamUrl(e){return encodeURIComponent(e)}function decodeParamIsUrl(e){return decodeURIComponent(e)}function injectHtml(e,t,n){t=t||null,e=e||null,e&&!t&&(t=document.getElementById(e)),t.innerHTML=n}function addCustomParamRow(){var e=document.getElementById("np");e?(injectHtml("tableContainer",null,'<table id="paramTable"></table>'),insertEmptyParamField()):insertEmptyParamField()}function insertEmptyParamField(){var e=document.getElementById("paramTable").insertRow(-1);numOfCustomeParams++;var t='<td style="width: 22px;"><input id="ccb'+numOfCustomeParams+'" type="checkbox" checked></td>';t+='<td style="width: 104px;"><input id="cinOne'+numOfCustomeParams+'" type="text" placeholder="Parameter name"></td>',t+='<td style="width: 636px;"><input id="cinTwo'+numOfCustomeParams+'" type="text" placeholder="Parameter value"></td>',e.innerHTML=t,checkBoxEvent("ccb"+numOfCustomeParams,"cinOne"+numOfCustomeParams,"cinTwo"+numOfCustomeParams),window.scrollTo(0,window.innerHeight)}function generateQR(e){var t=document.getElementById("qrcode");t.innerHTML="",new QRCode(t,{text:e,width:555,height:555})}!function(e){function t(e,n){return this instanceof t==0?new t(e,n):(this.Name=e,this.Count=n,this.getJson=function(){return{metricType:a.Count,name:this.Name,value:this.Count}},this)}function n(e,a,i){if(this instanceof n==0)return new n(e,a,i);var l={},r={};return r.getPayload=function(){var e=[];return l.Buffer.forEach(function(t){e.push(t.getJson())}),l.Buffer=[],e},r.startPumpTimeout=function(){null===l.FlushTimeout&&(l.FlushTimeout=setTimeout(l.FlushFn,1e3*l.FlushIntervalSec))},r.post=function(e,t,n,a){var i=new XMLHttpRequest;i.open("POST",e),i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(t)),i.onreadystatechange=function(){4===this.readyState&&(200===this.status?"function"==typeof n&&n(this):"function"==typeof a&&a(this))}},l.ServerEndpoint=e,l.MetricNamespace=a,l.FlushIntervalSec=i,l.FlushTimeout=null,l.Buffer=[],l.FlushFn=function(){if(l.FlushTimeout=null,l.Buffer.length>0){var e=l.ServerEndpoint+"API/Publish/Metrics",t={Metrics:r.getPayload()};r.post(e,t,r.startPumpTimeout,r.startPumpTimeout)}else r.startPumpTimeout()},l.LogCount=function(e,n){var a=new t(this.MetricNamespace+"."+e,n);l.Buffer.push(a)},l.FlushTimeout=setTimeout(l.FlushFn,1e3*l.FlushIntervalSec),l}var a={Unknown:0,Count:1};e.Html5Core=e.Html5Core||{},e.Html5Core.Metrics=e.Html5Core.Metrics||{},e.Html5Core.Metrics.Client=n,e.Html5Core.Metrics.CountMetric=t}(window);var originalUrl,numOfOriginalParams=0,numOfCustomeParams=0,client=new Html5Core.Metrics.Client("http://fpmatlair1/metrics/","oorl",2),TabObj=function(){function e(e,t){var n=t.split("?");originalUrl=n[0],injectHtml("header",null,'<h3>" '+e+' " :</h3><h4>'+originalUrl+"</h4>"),createParamTable(n.length>1?"&"+n[1]:n[0])}return e}();document.addEventListener("click",function(){console.log("pen")}),document.addEventListener("DOMContentLoaded",function(e){client.LogCount("extension.loaded",1)}),chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0];new TabObj(t.title,t.url);document.getElementById("addParamBtn").onclick=function(){addCustomParamRow()},document.getElementById("qrShowBtn").onclick=function(){window.innerHeight<640&&(document.body.style.height="640px"),document.getElementById("dialogBackground").style.display="table",generateQR(constructUrl())},document.getElementById("closeBtn").onclick=function(){document.getElementById("dialogBackground").style.display="none",document.body.style.height=""},document.getElementById("openUrlBtn").onclick=function(){var e={url:constructUrl()};document.getElementById("newtabChbox").checked?chrome.tabs.create(e):chrome.tabs.update(e)}});